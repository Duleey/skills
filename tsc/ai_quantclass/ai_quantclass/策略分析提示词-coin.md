# 量化策略全面分析 - AI提示词

## 使用说明

将下方提示词复制给AI（Claude/ChatGPT/Cursor），同时上传以下5个CSV文件：
- 资金曲线.csv
- 策略评价.csv
- 月度账户收益.csv
- 季度账户收益.csv
- 年度账户收益.csv

---

## 一键完整分析提示词

```
我有一套量化交易策略的回测数据，请用Python进行全面分析并生成可视化报告。

## 数据文件说明

1. **资金曲线.csv** - 逐小时交易记录，关键列：
   - candle_begin_time: 时间戳
   - equity: 账户权益
   - 净值: 归一化净值（从1开始）
   - 涨跌幅: 每周期收益率
   - leverage_ratio: 杠杆比例
   - long_short_ratio: 多空比例
   - long_pos_value/short_pos_value: 多空仓位价值
   - symbol_long_num/symbol_short_num: 多空品种数量
   - 净值dd2here: 当前回撤幅度

2. **策略评价.csv** - 核心指标（两列：指标名称，数值）

3. **月度/季度/年度账户收益.csv** - 周期收益（列：candle_begin_time, 涨跌幅）

---

## 第一步：数据加载与预处理

import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
from matplotlib.gridspec import GridSpec
import seaborn as sns
import warnings
warnings.filterwarnings('ignore')

# 设置中文字体（根据系统选择）
plt.rcParams['font.sans-serif'] = ['Arial Unicode MS', 'SimHei', 'PingFang SC', 'Microsoft YaHei']
plt.rcParams['axes.unicode_minus'] = False

# 配色方案
COLOR_UP = '#2ecc71'      # 正收益-绿色
COLOR_DOWN = '#e74c3c'    # 负收益-红色
COLOR_MAIN = '#3498db'    # 主色-蓝色
COLOR_GRAY = '#95a5a6'    # 灰色

# 加载数据
df_curve = pd.read_csv('资金曲线.csv', parse_dates=['candle_begin_time'])
df_eval = pd.read_csv('策略评价.csv', index_col=0)
df_monthly = pd.read_csv('月度账户收益.csv', parse_dates=['candle_begin_time'])
df_quarterly = pd.read_csv('季度账户收益.csv', parse_dates=['candle_begin_time'])
df_yearly = pd.read_csv('年度账户收益.csv', parse_dates=['candle_begin_time'])

# 清洗涨跌幅列（去除%符号转为小数）
for df in [df_monthly, df_quarterly, df_yearly]:
    if df['涨跌幅'].dtype == 'object':
        df['涨跌幅'] = df['涨跌幅'].str.rstrip('%').astype(float) / 100

# 基本信息
print("=" * 60)
print("数据概览")
print("=" * 60)
print(f"回测时间: {df_curve['candle_begin_time'].min()} ~ {df_curve['candle_begin_time'].max()}")
print(f"数据点数: {len(df_curve):,} 条（小时级）")
print(f"月度数据: {len(df_monthly)} 个月")
print(f"最终净值: {df_curve['净值'].iloc[-1]:.2f}")

---

## 第二步：生成12图综合仪表板

创建一个 3行4列共12个子图 的综合仪表板：

### 图表布局：

**第一行 - 核心曲线（跨2列）**
- [1-2列] 净值曲线（对数坐标），用红色阴影标注最大回撤区间
- [3-4列] 回撤曲线，用渐变填充显示回撤深度

**第二行 - 收益分析**
- [1列] 年度收益柱状图，在柱子上标注具体数值
- [2列] 季度收益热力图（行=年份2021-2026，列=Q1-Q4）
- [3-4列] 月度收益柱状图（正收益绿色，负收益红色）

**第三行 - 风险与仓位**
- [1列] 小时级收益率分布直方图，标注均值和±2σ
- [2列] 杠杆比例时序图
- [3列] 多空比例时序图，添加1.0参考线
- [4列] 持仓品种数量变化（多头+空头堆叠图）

### 图表要求：
- 整体尺寸：22x16英寸
- 标题字号：12pt，加粗
- 网格线：浅灰色，alpha=0.3
- 保存为PNG：dpi=150，文件名"策略分析仪表板.png"

---

## 第三步：计算统计指标

计算并打印以下指标（格式化输出表格）：

### 收益指标
- 累计收益率 = (最终净值 - 1) × 100%
- 年化收益率（从策略评价.csv读取或自行计算）
- 月度平均收益率
- 月度收益中位数
- 正收益月份占比（胜率）
- 最佳月度收益及时间
- 最差月度收益及时间

### 风险指标
- 最大回撤（从策略评价.csv读取）
- 最大回撤持续时间
- 平均回撤
- 月度收益标准差
- 下行标准差（只计算负收益月份）
- 回撤超过5%的次数
- 回撤超过10%的次数
- 回撤超过15%的次数

### 风险调整收益
- 夏普比率 = 年化收益 / (月度收益标准差 × √12)
- 索提诺比率 = 年化收益 / (下行标准差 × √12)
- 卡玛比率 = 年化收益 / |最大回撤|
- 收益回撤比（从策略评价.csv读取）

### 交易统计
- 胜率（正收益周期数/总周期数）
- 盈亏比（平均盈利/平均亏损）
- 最大连续盈利周期
- 最大连续亏损周期

### 仓位统计
- 平均杠杆
- 最大杠杆
- 多空比例均值
- 偏多时间占比（long_short_ratio > 1.2）
- 偏空时间占比（long_short_ratio < 0.8）
- 中性时间占比
- 平均持仓品种数（多头+空头）

---

## 第四步：回撤详细分析

### 4.1 找出最大的5次回撤

输出表格格式：
| 排名 | 回撤幅度 | 开始时间 | 谷底时间 | 恢复时间 | 持续天数 |
|------|----------|----------|----------|----------|----------|
| 1    | -20.38%  | 2024-07-05 | 2024-07-xx | 2024-xx-xx | xx天 |

### 4.2 回撤分布直方图

绘制单独的回撤分析图（保存为"回撤分析.png"）：
- 上图：回撤深度分布直方图
- 下图：回撤持续时间分布直方图

---

## 第五步：滚动分析

绘制滚动分析图（保存为"滚动分析.png"），包含3个子图：

1. **12个月滚动收益率**
   - 计算过去12个月的累计收益
   - 添加0%参考线

2. **12个月滚动夏普比率**
   - 计算过去12个月的夏普比率
   - 添加1.0和2.0参考线

3. **12个月滚动最大回撤**
   - 计算过去12个月内的最大回撤
   - 用红色区域填充

---

## 第六步：年度对比分析

### 6.1 年度对比表格

| 年份 | 收益率 | 最大回撤 | 夏普比率 | 正收益月数 | 月均收益 |
|------|--------|----------|----------|------------|----------|
| 2021 | 545.63% | -xx% | x.xx | 12/12 | xx% |
| 2022 | 140.35% | -xx% | x.xx | xx/12 | xx% |
| ... | | | | | |

### 6.2 年度趋势分析

- 计算年度收益的线性回归斜率
- 判断是否存在Alpha衰减趋势
- 对比2021年vs近两年的表现差异

---

## 第七步：生成综合评估报告

基于以上分析，生成Markdown格式的策略评估报告：

# 策略综合评估报告

## 1. 策略概况
- 回测期间：2021-01-01 ~ 2026-xx-xx（约xx个月）
- 累计收益：xxxxx%
- 年化收益：xxx%
- 最大回撤：-xx%
- 收益回撤比：xx.xx

## 2. 收益特征分析

### 2.1 收益分布
- 月度收益均值：xx%
- 月度收益中位数：xx%
- 收益标准差：xx%
- 偏度：xx（正偏/负偏/对称）
- 峰度：xx（厚尾/正常/薄尾）

### 2.2 年度表现
[插入年度对比表格]

### 2.3 季节性规律
- 表现最好的季度：Qx
- 表现最差的季度：Qx
- 是否存在明显季节性：是/否

## 3. 风险特征分析

### 3.1 回撤分析
- 最大回撤：-xx%（发生于xxxx年xx月）
- 平均回撤：-xx%
- 回撤恢复能力：平均xx天恢复

### 3.2 波动率分析
- 年化波动率：xx%
- 下行波动率：xx%

### 3.3 尾部风险
- 月度VaR(95%)：-xx%
- 单日最大亏损：-xx%

## 4. 仓位特征分析

### 4.1 杠杆使用
- 平均杠杆：xx倍
- 杠杆范围：xx ~ xx倍

### 4.2 多空偏好
- 偏多时间占比：xx%
- 偏空时间占比：xx%
- 中性时间占比：xx%

### 4.3 持仓分散度
- 平均持仓品种：xx个
- 单品种最大占比：xx%

## 5. 风险提示

### 5.1 Alpha衰减风险
- 2021年收益545%，近年收益约100%
- 年度收益呈[下降/稳定/波动]趋势
- 风险等级：[高/中/低]

### 5.2 过拟合嫌疑
- 早期收益是否异常高：是/否
- 策略复杂度：[高/中/低]
- 风险等级：[高/中/低]

### 5.3 市场环境依赖
- 牛市表现：xxx
- 熊市表现：xxx
- 震荡市表现：xxx

## 6. 综合评分（满分100分）

| 维度 | 得分 | 权重 | 加权分 |
|------|------|------|--------|
| 收益能力 | xx/30 | 30% | xx |
| 风险控制 | xx/30 | 30% | xx |
| 稳定性 | xx/20 | 20% | xx |
| 可持续性 | xx/20 | 20% | xx |
| **总分** | | | **xx/100** |

### 评分标准：
- 90+：优秀策略，可重仓配置
- 80-89：良好策略，可适度配置
- 70-79：一般策略，需谨慎配置
- <70：风险较高，建议观察

## 7. 结论与建议

[基于以上分析给出1-3条核心结论和操作建议]

---

## 输出文件清单

请确保生成以下文件：
1. 策略分析仪表板.png（主图，12子图）
2. 回撤分析.png
3. 滚动分析.png
4. 控制台打印所有统计指标
5. 输出完整的Markdown评估报告文本
```

---

## 简化版提示词（快速4图分析）

```
分析我的量化策略回测数据，生成一个2x2的核心图表：

1. 左上：净值曲线（对数坐标），标注最大回撤区间
2. 右上：月度收益柱状图（正绿负红）
3. 左下：回撤曲线（填充显示）
4. 右下：年度收益柱状图

同时输出关键指标：
- 累计收益、年化收益、最大回撤
- 夏普比率、卡玛比率
- 月度胜率、盈亏比

图表尺寸：14x10英寸
保存为：策略快速分析.png

数据文件：资金曲线.csv、月度账户收益.csv、年度账户收益.csv、策略评价.csv
```

---

## 单项分析提示词

### A. 净值曲线深度分析

```
绘制策略净值曲线专题分析图，要求：

1. 主图（上方70%区域）：
   - 净值曲线，使用对数坐标
   - 用红色半透明阴影标注最大回撤区间
   - 用水平虚线标注净值里程碑：2x, 5x, 10x, 50x, 100x, 200x, 300x
   - 添加30日和90日移动平均线

2. 副图（下方30%区域）：
   - 回撤曲线，用渐变红色填充
   - 标注回撤超过15%的区间

图表尺寸：16x10英寸
保存为：净值曲线分析.png

数据：资金曲线.csv的"净值"和"净值dd2here"列
```

### B. 收益分布专题分析

```
分析策略收益分布特征，生成4子图：

1. 左上：月度收益直方图 + 正态分布拟合曲线
2. 右上：月度收益QQ图（检验正态性）
3. 左下：月度收益箱线图（按年份分组）
4. 右下：累计收益vs时间散点图

计算并标注：
- 偏度、峰度
- VaR(95%)、CVaR(95%)
- Jarque-Bera正态性检验p值

数据：月度账户收益.csv
```

### C. 仓位专题分析

```
分析策略仓位管理特征，生成4子图：

1. 左上：杠杆比例时序图 + 移动平均
2. 右上：杠杆分布直方图
3. 左下：多空比例时序图，标注>1.5和<0.5的极端区间
4. 右下：杠杆vs后续24小时收益的散点图（分析相关性）

输出统计：
- 杠杆均值、最大值、标准差
- 多空比例分布统计

数据：资金曲线.csv
```

### D. 年度季度对比

```
对比各时间周期表现，生成3子图：

1. 上图：年度收益柱状图，标注数值，添加趋势线
2. 中图：季度收益热力图（行=年份，列=Q1-Q4），使用RdYlGn配色
3. 下图：月度收益热力图（行=年份，列=1-12月）

分析输出：
- 最佳/最差年份
- 最佳/最差季度
- 是否存在季节性规律
- Alpha衰减趋势判断

数据：年度账户收益.csv、季度账户收益.csv、月度账户收益.csv
```

---

## 进阶分析提示词

### E. 蒙特卡洛模拟

```
基于历史月度收益进行蒙特卡洛模拟：

1. 从月度收益中随机抽样（有放回），模拟未来12个月
2. 重复10000次，生成收益分布
3. 绘制：
   - 模拟路径扇形图（5%、25%、50%、75%、95%分位数）
   - 最终收益分布直方图
4. 计算：
   - 12个月后收益的95%置信区间
   - 亏损概率（净值<1）
   - 腰斩概率（净值<0.5）

数据：月度账户收益.csv
```

### F. 市场环境适应性（需额外数据）

```
分析策略在不同市场环境下的表现：

1. 根据BTC/市场基准将时间段分类：
   - 牛市：基准月涨幅>10%
   - 熊市：基准月涨幅<-10%
   - 震荡市：其他

2. 分别计算各环境下的：
   - 平均月收益
   - 胜率
   - 最大回撤

3. 绘制分组对比柱状图

需要额外提供：BTC价格数据或市场基准数据
```

### G. 收益归因分析

```
基于资金曲线的持仓数据，分析收益来源：

1. 多头贡献 vs 空头贡献（long_pos_value, short_pos_value）
2. 手续费消耗（fee列）占总收益比例
3. 资金费率收益/损失（funding_fee列）
4. 换手率与收益的关系（turnover列）

绘制：
- 收益来源饼图
- 手续费累计曲线
- 资金费率累计曲线

数据：资金曲线.csv
```

---

## 使用建议

| 分析目标 | 推荐提示词 |
|----------|------------|
| 快速了解策略 | 简化版（4图） |
| 完整全面分析 | 一键完整分析 |
| 深入风险研究 | A + 回撤分析 |
| 收益规律挖掘 | B + D |
| 仓位优化参考 | C |
| 未来预测模拟 | E |
| 投资报告撰写 | 一键完整分析 |
